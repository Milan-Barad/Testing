{% comment %} CSS for tabs and accordion styling {% endcomment %}
<style>
  .tab-container {
    max-width: 600px;
    margin: 20px auto;
    border: 1px solid #ccc;
  }
  .tab-buttons {
    display: flex;
    border-bottom: 1px solid #ccc;
  }
  .tab-button {
    flex: 1;
    padding: 10px;
    cursor: pointer;
    background: #f4f4f4;
    border: none;
    outline: none;
    text-align: center;
  }
  .tab-button:hover {
    background: #ddd;
  }
  .tab-button.active {
    background: #fff;
    border-bottom: 2px solid #000;
  }
  .tab-content {
    display: none;
    padding: 20px;
  }
  .tab-content.active {
    display: block;
  }
  .accordion {
    width: 100%;
    margin: 10px 0;
  }
  .accordion-item {
    border: 1px solid #ddd;
    margin-bottom: 5px;
  }
  .accordion-header {
    padding: 10px;
    cursor: pointer;
    background: #f4f4f4;
  }
  .accordion-header:hover {
    background: #ddd;
  }
  .accordion-panel {
    padding: 10px;
    display: none;
  }
  .accordion-panel.active {
    display: block;
  }
</style>

{% comment %} Liquid code for tabs and accordion {% endcomment %}
<div class="tab-container">
  {% comment %} Tab navigation {% endcomment %}
  <div class="tab-buttons">
    {% for block in section.blocks %}
      <button class="tab-button {% if forloop.first %}active{% endif %}" data-tab="tab-{{ block.id }}">
        {{ block.settings.tab_title | escape }}
      </button>
    {% endfor %}
  </div>

  {% comment %} Tab content with accordion {% endcomment %}
  {% for block in section.blocks %}
    <div id="tab-{{ block.id }}" class="tab-content {% if forloop.first %}active{% endif %}">
      <div class="accordion">
        {% for i in (1..4) %}
          {% assign accordion_title_key = 'accordion_title_' | append: i %}
          {% assign accordion_content_key = 'accordion_content_' | append: i %}
          {% if block.settings[accordion_title_key] != blank %}
            <div class="accordion-item">
              <div class="accordion-header" data-panel="panel-{{ block.id }}-{{ i }}">
                {{ block.settings[accordion_title_key] | escape }}
              </div>
              <div id="panel-{{ block.id }}-{{ i }}" class="accordion-panel">
                {{ block.settings[accordion_content_key] }}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>

{% comment %} JavaScript for tab and accordion functionality {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Hide all tab contents and remove active class from buttons
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });

        // Show selected tab content and mark button as active
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
        this.classList.add('active');
      });
    });

    // Accordion toggling
    const accordionHeaders = document.querySelectorAll('.accordion-header');
    accordionHeaders.forEach(header => {
      header.addEventListener('click', function() {
        const panelId = this.getAttribute('data-panel');
        const panel = document.getElementById(panelId);
        panel.classList.toggle('active');
      });
    });

    // Open first tab by default
    if (tabButtons.length > 0) {
      tabButtons[0].click();
    }
  });
</script>

{% comment %} Schema for the section {% endcomment %}
{% schema %}
{
  "name": "Dynamic Tabs ",
  "settings": [],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_title",
          "label": "Tab Title",
          "default": "Tab"
        },
        {
          "type": "text",
          "id": "accordion_title_1",
          "label": "Accordion 1 Title",
          "default": "Accordion Item 1"
        },
        {
          "type": "richtext",
          "id": "accordion_content_1",
          "label": "Accordion 1 Content",
          "default": "<p>Details about accordion item 1.</p>"
        },
        {
          "type": "text",
          "id": "accordion_title_2",
          "label": "Accordion 2 Title",
          "default": "Accordion Item 2"
        },
        {
          "type": "richtext",
          "id": "accordion_content_2",
          "label": "Accordion 2 Content",
          "default": "<p>Details about accordion item 2.</p>"
        },
        {
          "type": "text",
          "id": "accordion_title_3",
          "label": "Accordion 3 Title",
          "default": "Accordion Item 3"
        },
        {
          "type": "richtext",
          "id": "accordion_content_3",
          "label": "Accordion 3 Content",
          "default": "<p>Details about accordion item 3.</p>"
        },
        {
          "type": "text",
          "id": "accordion_title_4",
          "label": "Accordion 4 Title",
          "default": "Accordion Item 4"
        },
        {
          "type": "richtext",
          "id": "accordion_content_4",
          "label": "Accordion 4 Content",
          "default": "<p>Details about accordion item 4.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Dynamic Tabs ",
      "blocks": [
        {
          "type": "tab",
          "settings": {
            "tab_title": "Cartridges",
            "accordion_title_1": "Adios Blend: THCA + Delta-9P Live Resin",
            "accordion_content_1": "<p>Details about Adios Blend: THCA + Delta-9P Live Resin</p>",
            "accordion_title_2": "Adios MF Blend: THCA Live Sugar",
            "accordion_content_2": "<p>Details about Adios MF Blend: THCA Live Sugar</p>",
            "accordion_title_3": "Wreck'd Series: THCA + THCP + THCJD",
            "accordion_content_3": "<p>Details about Wreck'd Series: THCA + THCP + THCJD</p>",
            "accordion_title_4": "Lights Out Collection: THCH + THCJD",
            "accordion_content_4": "<p>Details about Lights Out Collection: THCH + THCJD</p>"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_title": "Disposables"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_title": "Edibles"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_title": "Flower"
          }
        }
      ]
    }
  ]
}
{% endschema %}