{% comment %} CSS for tabs and accordion styling {% endcomment %}
<style>
  .tab-container {
    max-width: 600px;
    margin: 20px auto;
    border: 1px solid #ccc;
  }
  .tab-buttons {
    display: flex;
    border-bottom: 1px solid #ccc;
  }
  .tab-button {
    flex: 1;
    padding: 10px;
    cursor: pointer;
    background: #f4f4f4;
    border: none;
    outline: none;
    text-align: center;
  }
  .tab-button:hover {
    background: #ddd;
  }
  .tab-button.active {
    background: #fff;
    border-bottom: 2px solid #000;
  }
  .tab-content {
    display: none;
    padding: 20px;
  }
  .tab-content.active {
    display: block;
  }
  .accordion {
    width: 100%;
    margin: 10px 0;
  }
  .accordion-item {
    border: 1px solid #ddd;
    margin-bottom: 5px;
  }
  .accordion-header {
    padding: 10px;
    cursor: pointer;
    background: #f4f4f4;
  }
  .accordion-header:hover {
    background: #ddd;
  }
  .accordion-panel {
    padding: 10px;
    display: none;
  }
  .accordion-panel.active {
    display: block;
  }
</style>

{% comment %} Liquid code for tabs and accordion {% endcomment %}
<div class="tab-container">
  {% comment %} Tab navigation {% endcomment %}
  <div class="tab-buttons">
    {% for block in section.blocks %}
      {% if block.type == 'tab' %}
        <button class="tab-button {% if forloop.first %}active{% endif %}" data-tab="tab-{{ block.id }}">
          {{ block.settings.tab_title | escape }}
        </button>
      {% endif %}
    {% endfor %}
  </div>

  {% comment %} Tab content with accordion {% endcomment %}
  {% for block in section.blocks %}
    {% if block.type == 'tab' %}
      <div id="tab-{{ block.id }}" class="tab-content {% if forloop.first %}active{% endif %}">
        <div class="accordion">
          {% for accordion_block in section.blocks %}
            {% if accordion_block.type == 'accordion' and accordion_block.settings.tab_id == block.id %}
              <div class="accordion-item">
                <div class="accordion-header" data-panel="panel-{{ accordion_block.id }}">
                  {{ accordion_block.settings.accordion_title | escape }}
                </div>
                <div id="panel-{{ accordion_block.id }}" class="accordion-panel">
                  {{ accordion_block.settings.accordion_content }}
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

{% comment %} JavaScript for tab and accordion functionality {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Hide all tab contents and remove active class from buttons
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });

        // Show selected tab content and mark button as active
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
        this.classList.add('active');
      });
    });

    // Accordion toggling
    const accordionHeaders = document.querySelectorAll('.accordion-header');
    accordionHeaders.forEach(header => {
      header.addEventListener('click', function() {
        const panelId = this.getAttribute('data-panel');
        const panel = document.getElementById(panelId);
        panel.classList.toggle('active');
      });
    });

    // Open first tab by default
    if (tabButtons.length > 0) {
      tabButtons[0].click();
    }
  });
</script>

{% comment %} Schema for the section {% endcomment %}
{% schema %}
{
  "name": "Dynamic Tabs ",
  "settings": [],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_title",
          "label": "Tab Title",
          "default": "Tab"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion Item",
      "settings": [
        {
          "type": "text",
          "id": "accordion_title",
          "label": "Accordion Title",
          "default": "Accordion Item"
        },
        {
          "type": "richtext",
          "id": "accordion_content",
          "label": "Accordion Content",
          "default": "<p>Details about accordion item.</p>"
        },
        {
          "type": "select",
          "id": "tab_id",
          "label": "Associated Tab",
          "options": [
            {
              "value": "",
              "label": "Select a tab"
            }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Dynamic Tabs ",
      "blocks": [
        {
          "type": "tab",
          "settings": {
            "tab_title": "Cartridges"
          }
        },
        {
          "type": "accordion",
          "settings": {
            "accordion_title": "Adios Blend: THCA + Delta-9P Live Resin",
            "accordion_content": "<p>Details about Adios Blend: THCA + Delta-9P Live Resin</p>",
            "tab_id": "{{ section.blocks[0].id }}"
          }
        },
        {
          "type": "accordion",
          "settings": {
            "accordion_title": "Adios MF Blend: THCA Live Sugar",
            "accordion_content": "<p>Details about Adios MF Blend: THCA Live Sugar</p>",
            "tab_id": "{{ section.blocks[0].id }}"
          }
        },
        {
          "type": "accordion",
          "settings": {
            "accordion_title": "Wreck'd Series: THCA + THCP + THCJD",
            "accordion_content": "<p>Details about Wreck'd Series: THCA + THCP + THCJD</p>",
            "tab_id": "{{ section.blocks[0].id }}"
          }
        },
        {
          "type": "accordion",
          "settings": {
            "accordion_title": "Lights Out Collection: THCH + THCJD",
            "accordion_content": "<p>Details about Lights Out Collection: THCH + THCJD</p>",
            "tab_id": "{{ section.blocks[0].id }}"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_title": "Disposables"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_title": "Edibles"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_title": "Flower"
          }
        }
      ]
    }
  ]
}
{% endschema %}