<style>
  .lab-results-section {
    padding: 80px 15px;
    max-width: 1300px;
    margin: 0 auto;
  }
  .lab-results-section__heading {
    font-family: "Bakbak One", sans-serif;
    font-size: 28px;
    font-weight: 700;
    padding-bottom: 20px;
  }
  .lab-results-section__tabs {
    display: flex;
    border: 1px solid #000;
    border-bottom: none;
    background: #fff;
  }
  .lab-results-section__tab {
    padding: 12px;
    cursor: pointer;
    font: 700 18px "Bakbak One", sans-serif;
    background: #fff;
    border: none;
    border-right: 1px solid #000;
    transition: background 0.3s;
  }
  .lab-results-section__tab.is-active {
    background: #c8b9b9;
  }
  .lab-results-section__panel {
    display: none;
    border: 1px solid #000;
    padding: 12px;
    background: #fff;
  }
  .lab-results-section__panel.is-active {
    display: block;
  }
  .lab-results-section__accordion {
    border: 1px solid #000;
    margin: 15px 0;
  }
  .lab-results-section__accordion-header {
    width: 100%;
    text-align: left;
    padding: 15px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    background: transparent;
    border: none;
  }
  .lab-results-section__accordion-header:after {
    content: "";
    border: solid #000;
    border-width: 0 2px 2px 0;
    width: 8px;
    height: 8px;
    transform: rotate(45deg);
  }
  .lab-results-section__accordion-header[aria-expanded="true"]::after {
    transform: rotate(225deg);
  }
  .lab-results-section__accordion-title {
    font: 500 18px "Bakbak One", sans-serif;
  }
  .lab-results-section__accordion-content {
    padding: 15px;
    border-top: 1px solid #000;
  }
  .lab-results-section__batch-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  .lab-results-section__batch-list li {
    margin-bottom: 20px;
    font: 500 18px "Bakbak One", sans-serif;
  }
  .lab-results-section__batch-list a {
    color: #000;
    font-weight: 700;
  }
  .lab-results-section__empty {
    margin-top: 10px;
    opacity: 0.7;
    font-size: 14px;
  }
</style>

<section id="lab-results-{{ section.id }}" class="lab-results-section">
  <div class="lab-results-section__details">
    {% if section.settings.heading != blank %}
      <h2 class="lab-results-section__heading">{{ section.settings.heading }}</h2>
    {% endif %}
    <div class="tabing-info" role="tablist">
      {% for block in section.blocks %}
        {% if block.type == 'accordion' and block.settings.city_name != blank %}
          <button class="w3-bar-item w3-button{% if forloop.first %} is-active{% endif %}" onclick="openCity('{{ block.settings.city_name | escape }}')" role="tab" aria-selected="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="lr-{{ section.id }}-{{ block.settings.city_name | escape }}" data-tab="{{ block.settings.city_name | escape }}">{{ block.settings.city_name }}</button>
        {% endif %}
      {% endfor %}
    </div>
    {% for block in section.blocks %}
      {% if block.type == 'accordion' and block.settings.city_name != blank %}
        <div id="lr-{{ section.id }}-{{ block.settings.city_name | escape }}" class="lab-results-section__panel{% if forloop.first %} is-active{% endif %}" role="tabpanel" tabindex="0">
          <div class="lab-results-section__accordion" {{ block.shopify_attributes }}>
            <button class="lab-results-section__accordion-header" type="button" aria-expanded="false">
              <span class="lab-results-section__accordion-title">{{ block.settings.title | escape }}</span>
            </button>
            <div class="lab-results-section__accordion-content" hidden>
              <ul class="lab-results-section__batch-list">
                {{ block.settings.batch_list_html }}
              </ul>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>

<script>
  (function() {
    const root = document.getElementById('lab-results-{{ section.id }}');
    if (!root) return;

    // Tab switching function
    window.openCity = function(tabName) {
      const tabs = root.querySelectorAll('.w3-bar-item.w3-button');
      const panels = root.querySelectorAll('.lab-results-section__panel');
      tabs.forEach(tab => {
        tab.classList.remove('is-active');
        tab.setAttribute('aria-selected', 'false');
      });
      panels.forEach(panel => panel.classList.remove('is-active'));
      
      const selectedTab = root.querySelector(`button[data-tab="${tabName}"]`);
      const selectedPanel = root.querySelector(`#lr-{{ section.id }}-${tabName}`);
      if (selectedTab && selectedPanel) {
        selectedTab.classList.add('is-active');
        selectedTab.setAttribute('aria-selected', 'true');
        selectedPanel.classList.add('is-active');
      }
    };

    // Accordion functionality
    const panels = root.querySelectorAll('.lab-results-section__panel');
    panels.forEach(panel => {
      panel.querySelectorAll('.lab-results-section__accordion').forEach(acc => {
        const btn = acc.querySelector('.lab-results-section__accordion-header');
        const content = acc.querySelector('.lab-results-section__accordion-content');
        if (!btn || !content) return;
        btn.addEventListener('click', () => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', !expanded);
          content.toggleAttribute('hidden', expanded);
        });
      });
    });
  })();
</script>

{% schema %}
  {
    "name": "Tab with accordion",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Check Out Our Lab Test Results:"
      }
    ],
    "blocks": [
      {
        "type": "accordion",
        "name": "Accordion",
        "settings": [
          {
            "type": "text",
            "id": "tab_target",
            "label": "Tab ID"
          },
          {
            "type": "text",
            "id": "tab_label",
            "label": "Tab title"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Question"
          },
          {
            "type": "richtext",
            "id": "batch_list_html",
            "label": "Answer"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Tab with accordion"
      }
    ]
  }
{% endschema %}