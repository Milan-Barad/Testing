<style>
  .tab-container { max-width: 600px; margin: 20px auto; border: 1px solid #ccc; font-family: Arial, sans-serif; }
  .tab-buttons { display: flex; border-bottom: 1px solid #ccc; }
  .tab-button { flex: 1; padding: 10px; cursor: pointer; background: #f4f4f4; border: none; outline: none; transition: background 0.3s; }
  .tab-button:hover { background: #ddd; }
  .tab-button.active { background: #fff; font-weight: bold; border-bottom: 2px solid #333; }
  .tab-content { display: none; padding: 15px; }
  .tab-content.active { display: block; }

  .accordion { width: 100%; margin: 10px 0; }
  .accordion-item { border: 1px solid #ddd; margin-bottom: 5px; border-radius: 4px; overflow: hidden; }
  .accordion-header { padding: 12px; cursor: pointer; background: #f4f4f4; position: relative; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s; }
  .accordion-header:hover { background: #ddd; }
  .accordion-header::after { content: '+'; font-size: 18px; transition: transform 0.3s ease; }
  .accordion-header.active::after { content: 'âˆ’'; }
  .accordion-panel { max-height: 0; overflow: hidden; opacity: 0; padding: 0 12px; transition: max-height 0.4s ease, opacity 0.4s ease, padding 0.3s ease; }
  .accordion-panel.active { opacity: 1; }
</style>

<div class="tab-container">
  <div class="tab-buttons">
    {% for block in section.blocks %}
      {% if block.type == 'tab' %}
        <button class="tab-button" onclick="openTab(event, 'tab-{{ block.id }}')">
          {{ block.settings.tab_title }}
        </button>
      {% endif %}
    {% endfor %}
  </div>

  {% for block in section.blocks %}
    {% if block.type == 'tab' %}
      <div id="tab-{{ block.id }}" class="tab-content">
        <div class="accordion">
          {% for subblock in block.blocks %}
            {% if subblock.type == 'accordion' %}
              <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion('accordion-{{ subblock.id }}')">
                  {{ subblock.settings.accordion_title }}
                </div>
                <div id="accordion-{{ subblock.id }}" class="accordion-panel">
                  {{ subblock.settings.accordion_content }}
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

<script>
  // Tabs
  function openTab(evt, tabName) {
    var i, tabContent, tabButtons;
    tabContent = document.getElementsByClassName("tab-content");
    for (i = 0; i < tabContent.length; i++) {
      tabContent[i].classList.remove("active");
    }
    tabButtons = document.getElementsByClassName("tab-button");
    for (i = 0; i < tabButtons.length; i++) {
      tabButtons[i].classList.remove("active");
    }
    document.getElementById(tabName).classList.add("active");
    evt.currentTarget.classList.add("active");

    var panels = document.getElementsByClassName("accordion-panel");
    var headers = document.getElementsByClassName("accordion-header");
    for (i = 0; i < panels.length; i++) {
      panels[i].classList.remove("active");
      panels[i].style.maxHeight = null;
      headers[i].classList.remove("active");
    }
  }

  // Accordion
  function toggleAccordion(panelId) {
    var panel = document.getElementById(panelId);
    var header = panel.previousElementSibling;

    if (panel.classList.contains("active")) {
      panel.classList.remove("active");
      header.classList.remove("active");
      panel.style.maxHeight = null;
    } else {
      var panels = document.getElementsByClassName("accordion-panel");
      var headers = document.getElementsByClassName("accordion-header");
      for (var i = 0; i < panels.length; i++) {
        panels[i].classList.remove("active");
        panels[i].style.maxHeight = null;
        headers[i].classList.remove("active");
      }
      panel.classList.add("active");
      header.classList.add("active");
      panel.style.maxHeight = panel.scrollHeight + "px";
    }
  }

  // Open first tab by default
  document.addEventListener("DOMContentLoaded", function() {
    var firstButton = document.querySelector(".tab-button");
    if(firstButton) firstButton.click();
  });
</script>

{% schema %}
{
  "name": "Tabs with Accordions",
  "settings": [],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        { 
          "type": "text", "id": "tab_title", "label": "Tab Title"
        }
      ],
    },
    {
      "type": "accordion",
      "name": "Accordion",
      "settings": [
        { "type": "text", "id": "accordion_title", "label": "Accordion Title" },
        { "type": "textarea", "id": "accordion_content", "label": "Accordion Content" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tabs with Accordions"
    }
  ]
}
{% endschema %}